# 安全配置指南

## 环境变量配置

为了确保代码库的安全性，所有敏感信息都应通过环境变量进行配置，而不是硬编码在代码中。

### 1. 创建环境变量文件

复制 `.env.example` 文件为 `.env`，并填入实际值：

```bash
cp .env.example .env
```

### 2. 必需的环境变量

#### 云开发配置
- `CLOUD_ENV_ID`: 云开发环境ID

#### MySQL数据库配置
- `MYSQL_HOST`: MySQL服务器地址
- `MYSQL_PORT`: MySQL端口（默认3306）
- `MYSQL_USER`: MySQL用户名
- `MYSQL_PASSWORD`: MySQL密码
- `MYSQL_DATABASE`: MySQL数据库名

#### 安全配置
- `JWT_SECRET`: JWT签名密钥

#### 课程表配置
- `COURSE_TABLE`: 默认课程表名
- `COURSE_TABLE_MAP`: 学院与课程表的映射关系（JSON格式）

### 3. 云函数环境变量配置

在微信开发者工具中，为每个云函数配置环境变量：

1. 打开云开发控制台
2. 进入"云函数"页面
3. 选择函数 → "配置" → "环境变量"
4. 添加上述环境变量

### 4. 安全最佳实践

1. **不要提交敏感文件**：
   - `.env` 文件已添加到 `.gitignore`
   - 不要提交包含真实密码或密钥的配置文件

2. **定期更新密钥**：
   - 定期更换JWT密钥
   - 使用强密码策略

3. **权限最小化**：
   - 为数据库用户分配最小必要权限
   - 限制云函数的访问权限

4. **监控与审计**：
   - 定期检查云函数访问日志
   - 监控异常访问行为

### 5. 部署前检查清单

- [ ] 所有敏感信息已通过环境变量配置
- [ ] `.env` 文件已添加到 `.gitignore`
- [ ] 云函数环境变量已正确配置
- [ ] 数据库连接测试通过
- [ ] JWT密钥已设置且足够复杂

### 6. 故障排除

如果遇到连接问题，请检查：

1. 环境变量是否正确设置
2. 云函数是否已重新部署
3. 数据库网络是否可访问
4. 用户权限是否足够

## 注意事项

- 本地开发时，确保 `.env` 文件不会被意外提交
- 生产环境应使用不同的密钥和密码
- 定期审查和更新安全配置