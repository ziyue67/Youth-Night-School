## 问题概述

* 小程序调用云函数报错：Cannot find module `wx-server-sdk`，导致积分与签到记录加载失败。

* 目前云函数运行时为 Node.js 10.15；`mysql2@3.x`与该运行时不兼容，需要使用 `mysql2@2.3.3` 或升级到 Node 16。

## 解决路线（任选其一，推荐路线A）

### 路线A：用微信开发者工具在 CloudBase 环境“云端安装依赖”部署（推荐）

* 打开微信开发者工具 → 云开发 → 选择环境 → 进入云函数列表。

选中 `dailySign` → 右键“上传并部署（云端安装依赖）”。

运行时选择 Node.js 16（优先）；如果暂时只能用 Node.js 10.15，则依赖版本为 `mysql2@2.3.3`（已在 package.json 配好）。

* 在函数“环境变量”中填好：`MYSQL_HOST`、`MYSQL_PORT`、`MYSQL_USER`、`MYSQL_PASSWORD`、`MYSQL_DATABASE`。

* 部署后在“云函数日志”查看是否出现 `backend: mysql` 日志返回。

### 路线B：用腾讯云 SCF 控制台上传包含 `node_modules` 的 ZIP 包

1. 在本地 `d:\Youth-Night-School\cloudfunctions\dailySign` 执行 `npm install --production` 以生成 `node_modules`（依赖包括 `wx-server-sdk` 与 `mysql2`）。
2. 打包为 `dailySign.zip`（包含 `index.js`、`package.json`、`package-lock.json`、`node_modules`）。
3. 在 SCF 控制台选择函数 `dailySign`，运行时选择 Node.js 16（优先）或保持 10.15；上传 ZIP 替换代码。
4. 在函数配置里设置相同的环境变量。
5. 通过“测试”执行 `{"action":"status"}`，期望返回 `backend: "mysql"`，并包含积分与记录。

## 可选增强（需代码改动）

* 在 `dailySign` 中增加兼容参数：当 `wx-server-sdk` 不可用或 `OPENID` 缺失时，允许从 `event.openid` 读取；这样可在 SCF 非 CloudBase 场景下联通（需你确认再改）。

* 若能升级运行时到 Node 16，可把 `mysql2` 升回 `^3.x`，并保持现有 MySQL 逻辑不变。

## 验证步骤

1. 前端“我的积分”页：进入后会调用 `dailySign` 的 `status`，应显示数据库中的积分与记录。
2. 前端“夜校任务”页：点击“签到”后再打开“我的积分”，积分增加并出现签到记录。
3. 云函数日志检查：看到返回体含 `backend: "mysql"`，无 `Cannot find module` 错误。

请确认采用路线A或B。我将据此继续执行部署或进行必要的代码兼容改动。
